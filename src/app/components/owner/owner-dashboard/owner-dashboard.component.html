<div class="d-flex min-vh-100">
  <!-- Sidebar -->
  <nav [class]="'sidebar ' + (isSidebarCollapsed ? 'collapsed' : 'expanded')">
    <div class="d-flex flex-column h-100">
      <!-- Logo -->
      <div class="p-3 d-flex align-items-center" [class.justify-content-center]="isSidebarCollapsed">
        <span class="fs-3"></span>
        <span *ngIf="!isSidebarCollapsed" class="ms-2 fs-4 fw-bold text-white">
          {{businessData.name || 'Coupon Sell System'}}
        </span>
      </div>

      <!-- Navigation -->
      <div class="flex-grow-1 p-3">
        <!-- Interface Section -->
        <div class="mb-4">
          <div [class]="'text-white-50 small ' + (isSidebarCollapsed ? 'text-center' : 'ps-3')">
            <span *ngIf="!isSidebarCollapsed">INTERFACE</span>
          </div>

          <div class="nav flex-column">
            <a routerLink="/o"
               class="sidebar-link nav-link d-flex align-items-center rounded p-3"
               [class.justify-content-center]="isSidebarCollapsed">
              <i class="fas fa-tachometer-alt"></i>
              <span *ngIf="!isSidebarCollapsed" class="ms-3">Dashboard</span>
            </a>

            <a
            [routerLink]="'/o/shop/' + businessId"
            routerLinkActive="active"
            [ngClass]="{ 'disabled': !shopExist }"
            class="sidebar-link nav-link d-flex align-items-center rounded p-3"
               [class.justify-content-center]="isSidebarCollapsed">
               <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#FFFFFF"><path d="M841-518v318q0 33-23.5 56.5T761-120H201q-33 0-56.5-23.5T121-200v-318q-23-21-35.5-54t-.5-72l42-136q8-26 28.5-43t47.5-17h556q27 0 47 16.5t29 43.5l42 136q12 39-.5 71T841-518Zm-272-42q27 0 41-18.5t11-41.5l-22-140h-78v148q0 21 14 36.5t34 15.5Zm-180 0q23 0 37.5-15.5T441-612v-148h-78l-22 140q-4 24 10.5 42t37.5 18Zm-178 0q18 0 31.5-13t16.5-33l22-154h-78l-40 134q-6 20 6.5 43t41.5 23Zm540 0q29 0 42-23t6-43l-42-134h-76l22 154q3 20 16.5 33t31.5 13ZM201-200h560v-282q-5 2-6.5 2H751q-27 0-47.5-9T663-518q-18 18-41 28t-49 10q-27 0-50.5-10T481-518q-17 18-39.5 28T393-480q-29 0-52.5-10T299-518q-21 21-41.5 29.5T211-480h-4.5q-2.5 0-5.5-2v282Zm560 0H201h560Z"/></svg>
               <span *ngIf="!isSidebarCollapsed" class="ms-3">Shop</span>

            </a>

            <a
              routerLink="/o/customers"
              routerLinkActive="active"
              [ngClass]="{ 'disabled': !shopExist }"
              class="sidebar-link nav-link d-flex align-items-center rounded p-3"
              [class.justify-content-center]="isSidebarCollapsed">
               <svg xmlns="http://www.w3.org/2000/svg" class="me-2" height="20px" viewBox="0 -960 960 960" width="20px" fill="#FFFFFF"><path d="M40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm720 0v-120q0-44-24.5-84.5T666-434q51 6 96 20.5t84 35.5q36 20 55 44.5t19 53.5v120H760ZM360-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm400-160q0 66-47 113t-113 47q-11 0-28-2.5t-28-5.5q27-32 41.5-71t14.5-81q0-42-14.5-81T544-792q14-5 28-6.5t28-1.5q66 0 113 47t47 113ZM120-240h480v-32q0-11-5.5-20T580-306q-54-27-109-40.5T360-360q-56 0-111 13.5T140-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T440-640q0-33-23.5-56.5T360-720q-33 0-56.5 23.5T280-640q0 33 23.5 56.5T360-560Zm0 320Zm0-400Z"/></svg>

              <span *ngIf="!isSidebarCollapsed" class="ms-3">Customers</span>
              <!-- <i *ngIf="!isSidebarCollapsed" class="fas fa-chevron-right ms-auto"></i> -->
            </a>
          </div>
        </div>

        <!-- Addons Section -->
        <div>
          <div [class]="'text-white-50 small ' + (isSidebarCollapsed ? 'text-center' : 'ps-3')">
            <span *ngIf="!isSidebarCollapsed">ADDONS</span>
          </div>

          <div class="nav flex-column">
            <a class="sidebar-link nav-link d-flex align-items-center rounded p-3"
               [class.justify-content-center]="isSidebarCollapsed">
              <i class="fas fa-fw fa-chart-area"></i>
              <span *ngIf="!isSidebarCollapsed" class="ms-3">Charts</span>
            </a>

            <a class="sidebar-link nav-link d-flex align-items-center rounded p-3"
               [class.justify-content-center]="isSidebarCollapsed">
              <i class="fas fa-fw fa-table"></i>
              <span *ngIf="!isSidebarCollapsed" class="ms-3">Tables</span>
            </a>
            <span
              class="btn btn-circle text-white p-4 my-5 mx-auto"
              (click)="toggleSidebar()"
              style="display: inline-flex; align-items: center; justify-content: center; width: 50px; height: 50px; border-radius: 50%;"
            >
              <i
                class="fas"
                [class.fa-chevron-right]="isSidebarCollapsed"
                [class.fa-chevron-left]="!isSidebarCollapsed">
              </i>
            </span>
          </div>
        </div>
      </div>

      <!-- Toggle Button -->
      <!-- <button class="btn text-white p-3 w-100 rounded-0 mb-5" (click)="toggleSidebar()">
        <i class="fas" [class.fa-chevron-right]="isSidebarCollapsed" [class.fa-chevron-left]="!isSidebarCollapsed"></i>
      </button> -->


    </div>
  </nav>

  <!-- Main Content -->
  <div class="flex-grow-1 bg-light">
    <!-- Header -->
    <header class="bg-white shadow-sm p-3 d-flex justify-content-between align-items-center">
      <div class="flex-grow-1 me-4">
        <div class="input-group w-50">
          <input type="search" class="form-control" placeholder="Search for...">
          <button class="btn btn-primary" type="button">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>

      <div class="d-flex align-items-center">
        <!-- QR Scanner -->
        <div class="me-1" *ngIf="shopExist" >
          <button
           class="btn btn-link"
           (click)="openQrScanner()"
           >
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#4e73df"><path d="M80-680v-200h200v80H160v120H80Zm0 600v-200h80v120h120v80H80Zm600 0v-80h120v-120h80v200H680Zm120-600v-120H680v-80h200v200h-80ZM700-260h60v60h-60v-60Zm0-120h60v60h-60v-60Zm-60 60h60v60h-60v-60Zm-60 60h60v60h-60v-60Zm-60-60h60v60h-60v-60Zm120-120h60v60h-60v-60Zm-60 60h60v60h-60v-60Zm-60-60h60v60h-60v-60Zm240-320v240H520v-240h240ZM440-440v240H200v-240h240Zm0-320v240H200v-240h240Zm-60 500v-120H260v120h120Zm0-320v-120H260v120h120Zm320 0v-120H580v120h120Z"/></svg>
          </button>
        </div>

        <!-- Notification button triggering the dropdown -->
        <div mdbDropdown class="d-flex me-3" *ngIf="shopExist" >
          <button
            class="btn btn-link position-relative me-2"
            id="notificationDropdown"
            mdbDropdownToggle
            aria-expanded="false"
          >
            <i class="fas fa-bell fs-6"></i>
            <span class="position-absolute notification-badge badge rounded-pill badge-notification bg-danger">
              3+
            </span>
          </button>

          <!-- Notification dropdown menu -->
          <ul
            mdbDropdownMenu
            class="dropdown-menu dropdown-menu-end"
            aria-labelledby="notificationDropdown"
          >
            <li>
              <a class="dropdown-item" href="#">
                <i class="fas fa-envelope me-2"></i>
                New message received
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#">
                <i class="fas fa-user-plus me-2"></i>
                New follower
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#">
                <i class="fas fa-exclamation-circle me-2"></i>
                Alert: Action required
              </a>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>
            <li>
              <a class="dropdown-item text-center" href="#">
                View all notifications
              </a>
            </li>
          </ul>
        </div>


        <!-- User Info -->
        <div class="me-5">
          <ul class="navbar-nav flex-row d-flex align-items-center me-4">
            <li *ngIf="!isLoggedIn" class="nav-item me-3"><a routerLink="/login" class="text-decoration-underline text-dark">Login</a></li>
              <li *ngIf="isLoggedIn" mdbDropdown class="nav-item ">
                <a
                  class="nav-link d-flex align-items-center"
                  id="userMenuButton"
                  role="button"
                  mdbDropdownToggle
                  aria-expanded="false"
                >
                  <img *ngIf="userInfo.authProvider == 'LOCAL'; else elseNoProfile"
                    [src]="userInfo.profile == null ? '/images/default-avatar.png' : getUserProfile(userInfo.profile)  " alt="User Avatar"
                    class="rounded-circle"
                    height="40"
                    width="40"
                    alt="User Avatar"
                  />
                  <ng-template #elseNoProfile>
                    <img
                    [src]="userInfo.profile "
                    class="rounded-circle"
                    height="40"
                    width="40"
                    alt="User Avatar"
                  />
                  </ng-template>
                </a>

      <ul mdbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuButton">
        <div class="px-3 py-2">
          <span class="d-block fw-bold">{{ userInfo.name || 'John Doe' }}</span>
          <span class="text-muted">{{ userInfo.email || 'johndoe@example.com' }}</span>
        </div>

        <div class="dropdown-divider mt-2 mb-2"></div>

        <li>
          <a class="dropdown-item" routerLink="/profile">
            <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
            <span class="ms-2">Profile</span>
          </a>
        </li>
        <li>
          <a class="dropdown-item" routerLink="/change-password">
            <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
           <span class="ms-2">Change Password</span>
          </a>
        </li>
        <div class="dropdown-divider"></div>
        <li>
          <a class="dropdown-item" (click)="logoutButton()" >
            <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
           <span class="ms-2">Logout</span>
          </a>
        </li>
      </ul>
    </li>

          </ul>
        </div>
      </div>


    </header>

    <!-- Main Content Area -->
    <main class="p-4">

<!--
      <div class="row">
       <div class="col-3">
        <div class="card  border-5 border-primary shadow-sm" >
          <div class="card-body border">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="text-xs font-weight-bold text-uppercase mb-1" >
                 Hello
                </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">100</div>

                <div class="mt-2">
                  <div class="progress progress-bar-custom">
                    <div class="progress-bar" role="progressbar">
                    </div>
                  </div>
                </div>
              </div>
              <div class="opacity-25">
                <!-- <i [class]="metric.icon + ' fa-2x'" [style.color]="metric.color"></i> -->
              <!-- </div>
            </div>
          </div>
        </div>
       </div>
      </div> -->

      <div *ngIf="loading" class="d-flex justify-content-center mt-3">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted d-block ms-2">Please Wait...</p>
      </div>

      <div *ngIf="!loading && !shopExist " class="shop-setup-placeholder">
        <h2>Oops! You Haven't Set Up Your Shop Yet!</h2>
        <p>Start showcasing your amazing products and reach your customers by creating your shop.</p>
        <div class="action-buttons">
            <button (click)="setupShop()">Create Your Shop</button>
        </div>
      </div>
      <router-outlet></router-outlet>

    </main>
  </div>
</div>
